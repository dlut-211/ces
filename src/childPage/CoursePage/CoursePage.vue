<template>
  <div class="CoursePage">
    <selectModule :object="selectModule" @submit="find"></selectModule>
    <tableModule :object="tableModule" @changePage="changePage" @changeSize="changeSize"
                 @addCourse="addCourse=true;$refs['addCourseForm'].resetFields();"></tableModule>
    <Modal
      v-model="addCourse"
      title="添加课程(教学大纲只支持doc,docx文件)"
      width="800px"
      :mask-closable="false">
      <Form :model="addCourseForm" label-position="left" :label-width="100" :rules="rules" ref="addCourseForm">
        <Row>
          <Col span="12">
            <FormItem label="课程编号" class="forms" prop="code">
              <Input v-model="addCourseForm.code"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="课程名称" class="forms" prop="name">
              <Input v-model="addCourseForm.name"></Input>
            </FormItem>
          </Col>
          <!--添加学科类型-->
          <Col span="12">
            <FormItem label="学科类型" class="forms" prop="subjectId">
              <Select v-model="addCourseForm.subjectId" :placeholder="'请选择学科类型'">
                <Option v-for="item in subjectTypeArr" :value="item.id" :key="item.id">{{item.optionValue}}</Option>
              </Select>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="描述" class="forms" prop="description">
              <Input type="textarea" v-model="addCourseForm.description" :autosize="{minRows: 5,maxRows: 5}"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="教学大纲" class="forms" prop="syllabusPath">
              <Upload :action="uploadFile" :format="['doc','docx']" :headers="{Authorization:$store.state.token}"
                      style="float: left; margin-right: 20px;" :show-upload-list="false"
                      :on-success="handleAddSyllabusSuccess" :on-format-error="handleFormatError">
                <Button type="ghost" icon="ios-cloud-upload-outline">点击上传文件</Button>
              </Upload>
              <div v-if="addCourseForm.syllabusPath">
                <a @click="downLoad()" target="blank">{{addCourseForm.syllabus}}</a>
              </div>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="addCourse=false">取消</Button>
        <Button type="primary" size="large" @click="addCourseHandleSubmit('addCourseForm')">确定</Button>
      </div>
    </Modal>
    <Modal v-model="editCourse" title="编辑课程(教学大纲只支持doc,docx文件)" width="800px" :mask-closable="false">
      <Form :model="editCourseForm" label-position="left" :label-width="100" :rules="rules" ref="editCourseForm">
        <Row>
          <Col span="12">
            <FormItem label="课程编号" class="forms" prop="code">
              <Input v-model="editCourseForm.code"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="课程名称" class="forms" prop="name">
              <Input v-model="editCourseForm.name"></Input>
            </FormItem>
          </Col>
          <!--添加学科类型-->
          <Col span="12">
            <FormItem label="学科类型" class="forms" prop="subjectId">
              <Select v-model="editCourseForm.subjectId">
                <Option v-for="item in subjectTypeArr" :value="item.id" :key="item.id">{{item.optionValue}}</Option>
              </Select>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="描述" class="forms" prop="description">
              <Input type="textarea" v-model="editCourseForm.description" :autosize="{minRows: 5,maxRows: 5}"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="教学大纲" class="forms" prop="syllabusPath">
              <Upload :action="uploadFile" :format="['doc','docx']" :headers="{Authorization:$store.state.token}"
                      style="float: left; margin-right: 20px;" :show-upload-list="false"
                      :on-success="handleEditSyllabusSuccess" :on-format-error="handleFormatError">
                <Button type="ghost" icon="ios-cloud-upload-outline">点击上传文件</Button>
              </Upload>
              <div v-if="editCourseForm.syllabusPath">
                <a @click="editDownLoad()" target="blank">{{editCourseForm.syllabus}}</a>
              </div>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="editCourse=false">取消</Button>
        <Button type="primary" size="large" @click="editCourseHandleSubmit('editCourseForm')">确定</Button>
      </div>
    </Modal>
    <Modal v-model="courseInfo" title="课程内容" width="1200px" :mask-closable="false" :footer-hide="true">
      <courseInfo
        :courseData="showForm"
        @addChapter="addChapterModal"
        @editChapter="editChapterModal"
        @deleteChapter="deleteChapterAction"
        @addKnowledge="addKnowledgeModal"
        @editKnowledge="editKnowledgeModal"
        @deleteKnowledge="deleteKnowledgeAction"
        @addWork="addWorkModal"
        @editWork="editWorkModal"
        @deleteWork="deleteWorkAction"
        @addClassWork="addClassWorkModal"
        @editClassWork="editClassWorkModal"
        @deleteClassWork="deleteClassWorkAction"
        ref="CourseDetail">
      </courseInfo>
    </Modal>
    <!-- 章节 -->
    <Modal v-model="addChapter" title="添加章节" width="400px" :mask-closable="false">
      <Form :model="addChapterForm" label-position="left" :label-width="100" :rules="chapterRule" ref="addChapterForm">
        <Row>
          <Col span="24">
            <FormItem label="章节名称" class="forms" prop="name">
              <Input v-model="addChapterForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="章节描述" class="forms" prop="description">
              <Input type="textarea" v-model="addChapterForm.description" :autosize="{minRows: 5,maxRows: 5}"></Input>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="addChapter=false">取消</Button>
        <Button type="primary" size="large" @click="addChapterHandleSubmit('addChapterForm')">确定</Button>
      </div>
    </Modal>
    <Modal v-model="editChapter" title="编辑章节" width="400px" :mask-closable="false">
      <Form :model="editChapterForm" label-position="left" :label-width="100" :rules="chapterRule"
            ref="editChapterForm">
        <Row>
          <Col span="24">
            <FormItem label="章节名称" class="forms" prop="name">
              <Input v-model="editChapterForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="章节描述" class="forms" prop="description">
              <Input type="textarea" v-model="editChapterForm.description" :autosize="{minRows: 5,maxRows: 5}"></Input>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="editChapter=false">取消</Button>
        <Button type="primary" size="large" @click="editChapterHandleSubmit('editChapterForm')">确定</Button>
      </div>
    </Modal>
    <!-- 知识点 -->
    <Modal v-model="addKnowledge" title="添加知识点" width="800px" :mask-closable="false">
      <Form :model="addKnowledgeForm" label-position="left" :label-width="100" :rules="knowledgeRule"
            ref="addKnowledgeForm">
        <Row>
          <Col span="12">
            <FormItem label="知识点名称" class="forms" prop="name">
              <Input v-model="addKnowledgeForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="能力点" class="forms" prop="abilityName">
              <Input v-model="addKnowledgeForm.abilityName" disabled style="width:160px;" placeholder="请选择能力点"></Input>
              <Button type="info" @click="GetData()">点击选择</Button>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="addKnowledge=false">取消</Button>
        <Button type="primary" size="large" @click="addKnowledgeHandleSubmit('addKnowledgeForm')">确定</Button>
      </div>
    </Modal>
    <Modal v-model="editKnowledge" title="编辑知识点" width="800px" :mask-closable="false">
      <Form :model="editKnowledgeForm" label-position="left" :label-width="100" :rules="knowledgeRule"
            ref="editKnowledgeForm">
        <Row>
          <Col span="12">
            <FormItem label="知识点名称" class="forms" prop="name">
              <Input v-model="editKnowledgeForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="12">
            <FormItem label="能力点" class="forms" prop="abilityName">
              <Input v-model="editKnowledgeForm.abilityName" disabled style="width:160px;" placeholder="请选择能力点"></Input>
              <Button type="info" @click="GetData()">点击选择</Button>
            </FormItem>
          </Col>
        </Row> 
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="editKnowledge=false">取消</Button>
        <Button type="primary" size="large" @click="editKnowledgeHandleSubmit('editKnowledgeForm')">确定</Button>
      </div>
    </Modal>
    <!-- 能力点 showForm :subjectData="showForm.SubjectId"-->
    <abilityModal :visible="abilityModalVisible" :subjectData="LocalSubjectId" ref="ChildAbility"
                  @submit="abilityModalSubmit" @cancel="abilityModalVisible=false"></abilityModal>
    <!-- 作业 -->
    <Modal
      v-model="addWork"
      title="添加作业"
      width="800px"
      :mask-closable="false">
      <Form :model="addWorkForm" label-position="left" :label-width="100" :rules="workRule" ref="addWorkForm">
        <Row>
          <Col span="24">
            <FormItem label="作业名称" class="forms" prop="name">
              <Input v-model="addWorkForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="作业描述" class="forms" prop="description">
              <weditorModule ref="addEditor" :keys="1"></weditorModule>
              <!-- <Input type="textarea" v-model="addWorkForm.description" :autosize="{minRows: 5,maxRows: 5}"></Input> -->
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="知识点" class="forms" prop="knowledgeIdList">
              <Select filterable v-model="addWorkForm.knowledgeIdList" multiple :placeholder="'请选择知识点'" transfer>
                <Option v-for="item in knowledgeList" :value="item.id" :key="item.id">{{ item.name }}</Option>
              </Select>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="addWork=false">取消</Button>
        <Button type="primary" size="large" @click="addWorkHandleSubmit('addWorkForm')">确定</Button>
      </div>
    </Modal>
    <Modal v-model="editWork" title="编辑作业" width="800px" :mask-closable="false">
      <Form :model="editWorkForm" label-position="left" :label-width="100" :rules="workRule" ref="editWorkForm">
        <Row>
          <Col span="24">
            <FormItem label="作业名称" class="forms" prop="name">
              <Input v-model="editWorkForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="作业描述" class="forms" prop="description">
              <weditorModule ref="editEditor" :keys="2"></weditorModule>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="知识点" class="forms" prop="Knowledges">
              <Select filterable v-model="editWorkForm.knowledgeIdList" multiple :placeholder="'请选择知识点'" transfer>
                <Option v-for="item in knowledgeList" :value="item.selectId" :key="item.selectId">{{ item.name }}</Option>
              </Select>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="editWork=false">取消</Button>
        <Button type="primary" size="large" @click="editWorkHandleSubmit('editWorkForm')">确定</Button>
      </div>
    </Modal>

    <!-- 随堂作业-->
    <Modal
      v-model="addClassWork"
      title="添加课堂作业"
      width="800px"
      :mask-closable="false">
      <Form :model="addClassWorkForm" label-position="left" :label-width="100" :rules="classWorkRule" ref="addClassWorkForm">
        <Row>
          <Col span="24">
            <FormItem label="题目名称" class="forms" prop="name">
              <Input v-model="addClassWorkForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项A" class="forms" prop="item1">
              <Input v-model="addClassWorkForm.item1"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项B" class="forms" prop="item2">
              <Input v-model="addClassWorkForm.item2"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项C" class="forms" prop="item3">
              <Input v-model="addClassWorkForm.item3"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项D" class="forms" prop="item4">
              <Input v-model="addClassWorkForm.item4"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="正确选项" class="forms" prop="ans">
              <RadioGroup v-model="addClassWorkForm.ans">
                <Radio label="A" border></Radio>
                <Radio label="B" border></Radio>
                <Radio label="C" border></Radio>
                <Radio label="D" border></Radio>
              </RadioGroup>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="知识点" class="forms" prop="knowledgeId">
              <Select filterable v-model="addClassWorkForm.knowledgeId" :placeholder="'请选择知识点'" transfer>
                <Option v-for="item in knowledgeList" :value="item.id" :key="item.id">{{ item.name }}</Option>
              </Select>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="addClassWork=false">取消</Button>
        <Button type="primary" size="large" @click="addClassWorkHandleSubmit('addClassWorkForm')">确定</Button>
      </div>
    </Modal>

    <Modal
      v-model="editClassWork"
      title="编辑课堂作业"
      width="800px"
      :mask-closable="false">
      <Form :model="editClassWorkForm" label-position="left" :label-width="100" :rules="classWorkRule" ref="editClassWorkForm">
        <Row>
          <Col span="24">
            <FormItem label="题目名称" class="forms" prop="name">
              <Input v-model="editClassWorkForm.name"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项A" class="forms" prop="item1">
              <Input v-model="editClassWorkForm.item1"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项B" class="forms" prop="item2">
              <Input v-model="editClassWorkForm.item2"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项C" class="forms" prop="item3">
              <Input v-model="editClassWorkForm.item3"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="选项D" class="forms" prop="item4">
              <Input v-model="editClassWorkForm.item4"></Input>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="正确选项" class="forms" prop="ans">
              <RadioGroup v-model="editClassWorkForm.ans">
                <Radio label="A" border></Radio>
                <Radio label="B" border></Radio>
                <Radio label="C" border></Radio>
                <Radio label="D" border></Radio>
              </RadioGroup>
            </FormItem>
          </Col>
          <Col span="24">
            <FormItem label="知识点" class="forms" prop="knowledgeId">
              <Select filterable v-model="editClassWorkForm.knowledgeId" :placeholder="'请选择知识点'" transfer>
                <Option v-for="item in knowledgeList" :value="item.id" :key="item.id">{{ item.name }}</Option>
              </Select>
            </FormItem>
          </Col>
        </Row>
      </Form>
      <div slot="footer">
        <Button type="ghost" size="large" @click="editClassWork=false">取消</Button>
        <Button type="primary" size="large" @click="editClassWorkHandleSubmit('editClassWorkForm')">确定</Button>
      </div>
    </Modal>
    
  </div>
</template>
<script>
    // 引入查询模块组件
    import selectModule from "@/components/selectModule/selectModule.vue";
    // 引入表格模块组件
    import tableModule from "@/components/tableModule/tableModule.vue";
    // 引入查询模块配置项
    import {CourseSelectModuleJS} from "./CourseSelectModuleJS.js";
    // 引入表格模块配置项
    import {CourseTableModuleJS} from "./CourseTableModuleJS.js";
    // 引入课程内容组件
    import courseInfo from "@/components/courseInfo/courseInfo.vue";
    // 引入能力点选择模态框
    import abilityModal from "@/modal/abilityModal/abilityModal.vue";
    // 引入富文本编辑器
    import weditorModule from "@/components/weditorModule/weditorModule.vue";
    // 引入API
    import * as Http from "@/api/HttpService.js";
    import {API} from "@/api/HttpConfig";
    import axios from 'axios';
    export default {
        computed: {
            uploadFile: function () {
                return API.uploadFile + '?filesname=syllabus';
            }
        },

        data: function () {
            return {
                selectModule: (CourseSelectModuleJS.bind(this))(),
                tableModule: (CourseTableModuleJS.bind(this))(),
                addCourse: false,
                addCourseForm: {
                    code: "",
                    description: "",
                    name: "",
                    syllabus: "",
                    syllabusPath: "",
                    subjectName: "",
                    subjectId: null,
                    createdBy: null
                },
                LocalSubjectId: null,
                editCourse: false,
                editCourseForm: {
                    id: null,
                    subjectName: "",
                    code: "",
                    description: "",
                    name: "",
                    syllabus: "",
                    syllabusPath: "",
                    subjectId: null,
                    createdBy: null
                },
                nowPage: 1,
                pageSize: 10,
                findCourseForm: {
                    code: "",
                    name: "",
                    createdByName: ""
                },
                rules: {
                    code: [
                        {required: true, message: "课程编号不能为空", trigger: "blur"}
                    ],
                    description: [
                        {required: true, message: "描述不能为空", trigger: "blur"}
                    ],
                    name: [
                        {required: true, message: "课程名称不能为空", trigger: "blur"}
                    ],
                    subjectId: [
                        {required: true, message: "学期类型不能为空", trigger: "change", type: 'number'}
                    ]
                },
                //课程学科类型
                subjectTypeArr: [],
                // 课程内容
                courseInfo: false,
                showForm: {
                    id: null,
                    code: "",
                    name: "",
                    description: "",
                    syllabus: "",
                    syllabusPath: "",
                    createdByName: "",
                    createdOn: "",
                    subjectId: null,
                    subjectName: ""
                },
                // 章节==================================
                addChapter: false,
                addChapterForm: {
                    chapterLevel: null,
                    courseId: null,
                    name: "",
                    parentId: null,
                    description: ""
                },
                editChapter: false,
                editChapterForm: {
                    id: null,
                    chapterLevel: null,
                    courseId: null,
                    name: "",
                    parentId: null,
                    description: "",
                },
                chapterRule: {
                    name: [
                        {required: true, message: "章节名称不能为空", trigger: "blur"}
                    ]
                },
                // 知识点===========================
                addKnowledge: false,
                addKnowledgeForm: {
                    name: "",
                    courseId: null,
                    abilityName: "",
                    abilityId: null
                },
                editKnowledge: false,
                editKnowledgeForm: {
                    id: null,
                    name: "",
                    courseId: null,
                    abilityName: "",
                    abilityId: null,
                },
                knowledgeRule: {
                    name: [
                        {required: true, message: "知识点名称不能为空", trigger: "blur"}
                    ],
                    abilityName: [
                        {required: true, message: "能力点不能为空", trigger: "blur"}
                    ]
                },

                /**
                 * 控制能力点模态框是否显示
                 */
                abilityModalVisible: false,

                /**
                 * 添加作业
                 */
                addWork: false,
                addWorkForm: {
                    description: "",
                    chapterId: null,
                    name: "",
                    knowledgeIdList: ""
                },

                /**
                 * 编辑作业
                 */
                editWork: false,
                editWorkForm: {
                    id: null,
                    description: "",
                    chapterId: null,
                    name: "",
                    knowledgeIdList: ""
                },
                workRule: {
                    knowledgeIdList: [
                        {required: true, message: "知识点不能为空", trigger: "change", type: "array"}
                    ],
                    name: [
                        {required: true, message: "作业名称不能为空", trigger: "blur"}
                    ]
                },
                // 随堂作业============================================
                addClassWork: false,
                addClassWorkForm: {
                    chapterId: null,
                    name: "",
                    item1:"",
                    item2:"",
                    item3:"",
                    item4:"",
                    ans:"",
                    knowledgeId:"",
                    courseId:""
                },
                editClassWork:false,
                editClassWorkForm: {
                    id:null,
                    chapterId: null,
                    name: "",
                    item1:"",
                    item2:"",
                    item3:"",
                    item4:"",
                    ans:"",
                    knowledgeId:"",
                    courseId:""
                },

                classWorkRule: {
                    name: [
                        {required: true, message: "作业名称不能为空", trigger: "blur"}
                    ],
                    item1:[
                      {required: true, message: "选项A不能为空", trigger: "blur"}
                    ],
                    item2:[
                      {required: true, message: "选项B不能为空", trigger: "blur"}
                    ],
                    item3:[
                      {required: true, message: "选项C不能为空", trigger: "blur"}
                    ],
                    item4:[
                      {required: true, message: "选项D不能为空", trigger: "blur"}
                    ],
                    ans:[
                      {required: true, message: "请设置一个正确答案", trigger: "blur"}
                    ],
                    knowledgeId: [
                        {type: 'number', required: true, message: "知识点不能为空", trigger: "change"},
                    ],
                },

                /**
                 * 章节作业下的知识点列表
                 */
                knowledgeList: [],
                subjectId: null
            };
        },

        mounted: function () {
            this.$store.commit("changeBreadCrumb", [
                "首页",
                "教学管理",
                "课程管理"
            ]);
            this.$store.commit("changeOpenName", [""]);
            this.$store.commit("changeActiveName", "NetGraphPage");
            this.getCourseList();
            //调用获取学科列表方法
            this.getAllSubjects();
        },

        components: {
            selectModule: selectModule,
            tableModule: tableModule,
            courseInfo: courseInfo,
            abilityModal: abilityModal,
            weditorModule: weditorModule
        },

        methods: {
            //获取数据
            GetData: function () {
                this.abilityModalVisible = true;
                this.$refs.ChildAbility.getAbilityList();
            },
            handleAddSyllabusSuccess: async function (res, file) {
                if (res.statusCode === 1) {
                    this.addCourseForm.syllabusPath = res.data.path;
                    this.addCourseForm.syllabus = res.data.fileName;
                }
            },
            // 编辑上传成功钩子 异步方法
            handleEditSyllabusSuccess: async function (res, file) {
                if (res.statusCode === 1) {
                    this.editCourseForm.syllabusPath = res.data.path;
                    this.editCourseForm.syllabus = res.data.fileName;
                }
            },
            // 文件格式验证失败钩子
            handleFormatError: function (res, file) {
                this.$Message.error("文件格式不正确");
            },
            //   添加表单验证方法
            addCourseHandleSubmit: function (name) {
                return this.$refs[name].validate(valid => {
                    if (valid) {
                        this.addCourseAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
            },
            // 修改表单验证方法
            editCourseHandleSubmit: async function (name) {
                const result = await this.$refs.editCourseForm.validate(valid => {});
                if (result) {
                    this.editCourseAction();
                } else {
                    this.$Message.error("表单信息不正确!");
                }
            },
            // 查询方法
            find: function (a) {
                this.findCourseForm.code = a.code ?
                    a.code : "";
                this.findCourseForm.name = a.name ?
                    a.name : "";
                this.findCourseForm.createdByName = a.createdByName ?
                    a.createdByName : "";
                this.getCourseList();
            },
            // 改变页码
            changePage: function (page) {
              console.log('现在的页码是:'+page);
                this.nowPage = page;
                this.getCourseList();
            },
            // 改变每页显示的条数
            changeSize: function (size) {
                this.pageSize = size;
                this.getCourseList();
            },
            //添加课程时获取学科列表
            getAllSubjects: function () {
                Http.getAllSubjectList().then(res => {
                    if (res.statusCode === 1) {
                        this.subjectTypeArr = res.data;
                    }
                });
            },

            /**
             * 添加课程Action
             */
            addCourseAction: function () {
              this.addCourseForm.createdBy = this.$store.state.id;
                const params = this.addCourseForm;
                Http.postCourse(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.addCourseForm = {
                            code: "",
                            description: "",
                            name: "",
                            syllabus: "",
                            syllabusPath: "",
                            subjectId: null,
                            createdBy: null
                        };
                        this.addCourse = false;
                        this.$refs["addCourseForm"].resetFields();
                        this.getCourseList();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },

            /**
             * 编辑课程Action 
             */
            editCourseAction: function () {
                this.editCourseForm.createdBy = this.$store.state.id;
                const params = this.editCourseForm;
                Http.putCourse(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.editCourseForm = {
                            id: null,
                            code: "",
                            description: "",
                            name: "",
                            syllabus: "",
                            syllabusPath: "",
                            createdBy: null
                        };
                        this.editCourse = false;
                        this.$refs["editCourseForm"].resetFields();
                        this.getCourseList();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },

            /**
             * 获取课程列表
             */
            getCourseList: function () {
              
                const params = {
                    page: this.nowPage,
                    pageSize: this.pageSize,
                    Code: this.findCourseForm.code,
                    name: this.findCourseForm.name
                };
                console.log('页码参数:'+params.nowPage);
                Http.getCourseList(params).then(res => {
                    if (res.statusCode === 1) {
                     
                       console.log('获得的数据'+res.data.content[0].code);
                        this.tableModule.tableContent = res.data.content;
                        this.tableModule.count = res.data.totalElements;
                    }
                })
            },

            /**
             * 删除课程Action
             */
            deleteCourseAction: function (id) {
                const params = {
                    id: id
                };
                Http.deleteCourse(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success("删除成功");
                        this.getCourseList();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },
  //下载文件
            downLoad:function(){
                const params = {
                    fileName: this.addCourseForm.syllabus
                };
              axios({
               method: 'GET',
                url: '/api/course/fileDownload',
                params: params,
                      responseType: 'blob'
               }).then(res=>{
              this.addDownloadFile(res.data);
                  })
            },
             editDownLoad:function(){
                const params = {
                    fileName: this.editCourseForm.syllabus
                };
              axios({
               method: 'GET',
               url: '/api/course/fileDownload',
               params: params,
                      responseType: 'blob'
               }).then(res=>{
              this.downloadFile(res.data);
                  })
            },
        addDownloadFile:function(data) {
        if (!data) {
          return
        }
        let url = window.URL.createObjectURL(new Blob([data],{type:'application/octet-stream'}));
        let link = document.createElement('a');
        link.style.display = 'none';
        link.href = url;
        link.setAttribute('download', this.addCourseForm.syllabus);
        document.body.appendChild(link);
        link.click()
      },
        downloadFile:function(data) {
        if (!data) {
          return
        }
        let url = window.URL.createObjectURL(new Blob([data],{type:'application/octet-stream'}));
        let link = document.createElement('a');
        link.style.display = 'none';
        link.href = url;
        link.setAttribute('download', this.editCourseForm.syllabus);
      document.body.appendChild(link);
        link.click()
      },

            /**
             * 添加章节模态框
             * @param a
             */
            addChapterModal: function (a) {
                this.addChapterForm = a;
                this.$refs['addChapterForm'].resetFields();
                this.addChapter = true;
            },

            /**
             * 编辑章节模态框
             * @param a
             */
            editChapterModal: function (a) {
                this.editChapterForm = a;
                this.$refs['editChapterForm'].resetFields();
                this.editChapter = true;
            },

            /**
             * 添加章节表单验证方法
             * @param name
             * @returns
             */
            addChapterHandleSubmit: function (name) {
                const result = this.$refs[name].validate(valid => {
                    if (valid) {
                        this.addChapterAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
                return result;
            },

            /**
             * 修改章节表单验证方法
             * @param name
             * @returns {Promise<void>}
             */
            editChapterHandleSubmit: async function (name) {
                const result = await this.$refs.editChapterForm.validate(valid => {});
                if (result) {
                    this.editChapterAction();
                } else {
                    this.$Message.error("表单信息不正确!");
                }
            },

            /**
             * 添加章节Action
             */
            addChapterAction: function () {
                const params = this.addChapterForm;
                Http.postChapter(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.addChapterForm = {
                            chapterLevel: null,
                            courseId: null,
                            name: "",
                            parentId: null,
                            description: ""
                        };
                        this.addChapter = false;
                        this.$refs["addChapterForm"].resetFields();
                        this.$refs.CourseDetail.getChapters();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },

            /**
             * 编辑章节Action
             */
            editChapterAction: function () {
                const params = this.editChapterForm;
                Http.putChapter(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.editChapterForm = {
                            id: null,
                            chapterLevel: null,
                            courseId: null,
                            name: "",
                            parentId: null,
                            description: ""
                        };
                        this.editChapter = false;
                        this.$refs["editChapterForm"].resetFields();
                        this.$refs.CourseDetail.getChapters();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },

            /**
             * 删除章节Action
             * @param id
             */
            deleteChapterAction: function (id) {
                this.$Modal.confirm({
                    title: "<span style='color:red'><b>提示</b></span>",
                    content: "确定要删除当前章节及子章节吗？",
                    onOk: () => {
                        const params = {
                            id: id
                        };
                        Http.deleteChapter(params).then(res => {
                            if (res.statusCode === 1) {
                                this.$Message.success("删除成功");
                                this.$refs.CourseDetail.getChapters();
                            } else {
                                this.$Message.error(res.message);
                            }
                        })
                    },
                    onCancel: () => {
                    }
                })
            },

            /**
             * 添加知识点模态框
             * @param a
             */
            addKnowledgeModal: function (a) {
                this.addKnowledgeForm = a;
                this.$refs['addKnowledgeForm'].resetFields();
                this.addKnowledge = true;
            },

            /**
             * 编辑知识点模态框
             * @param a
             */
            editKnowledgeModal: function (a) {
                this.editKnowledgeForm = a;
                this.$refs['editKnowledgeForm'].resetFields();
                this.editKnowledge = true;
            },

            /**
             * 添加知识点表单验证方法
             * @param name
             * @returns
             */
            addKnowledgeHandleSubmit: function (name) {
                const result = this.$refs[name].validate(valid => {
                    if (valid) {
                        this.addKnowledgeAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
                return result;
            },

            /**
             * 添加知识点Action
             */
            addKnowledgeAction: function () {
                const params = this.addKnowledgeForm;
                Http.postKnowledge(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.addKnowledgeForm = {
                            name: "",
                            courseId: "",
                            abilityId: ""
                        };
                        this.addKnowledge = false;
                        this.$refs["addKnowledgeForm"].resetFields();
                        this.$refs.CourseDetail.getKnowledgeList();
                        this.$refs.CourseDetail.getCourseKnowledgeList();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },

            /**
             * 修改知识点表单验证方法
             * @param name
             * @returns
             */
            editKnowledgeHandleSubmit: async function (name) {
                const result = await this.$refs.editKnowledgeForm.validate(valid => {});
                if (result) {
                    this.editKnowledgeAction();
                } else {
                    this.$Message.error("表单信息不正确!");
                }
            },

            /**
             * 修改知识点Action
             * @param name
             * @returns
             */
            editKnowledgeAction: function () {
                const params = this.editKnowledgeForm;
                Http.putKnowledge(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.editKnowledgeForm = {
                            id: null,
                            name: "",
                            courseId: "",
                            abilityId: "",
                        };
                        this.editKnowledge = false;
                        this.$refs["editKnowledgeForm"].resetFields();
                        this.$refs.CourseDetail.getKnowledgeList();
                        this.$refs.CourseDetail.getCourseKnowledgeList();
                    } else {
                        this.$Message.error(res.message);
                    }
                })

            },

            /**
             * 删除知识点Action
             * @param id
             */
            deleteKnowledgeAction: function (id) {
                const params = {
                    id: id
                };
                Http.deleteKnowledge(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success("删除成功");
                        this.$refs.CourseDetail.getKnowledgeList();
                        this.$refs.CourseDetail.getCourseKnowledgeList();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },

            /**
             * 提交能力点模态框
             * @param a
             */
            abilityModalSubmit: function (a) {
                if (this.addKnowledge) {
                    this.addKnowledgeForm.abilityName = a.name;
                    this.addKnowledgeForm.abilityId = a.id;
                } else {
                    this.editKnowledgeForm.abilityName = a.name;
                    this.editKnowledgeForm.abilityId = a.id;
                }
                this.abilityModalVisible = false;
            },

            /**
             * 添加作业模态框
             * @param addWorkForm
             * @param knowledgeList
             */
            addWorkModal: function (addWorkForm, knowledgeList) {
                this.addWorkForm = addWorkForm;
                this.$refs.addEditor.setContent('');
                this.knowledgeList = knowledgeList;
                this.$refs['addWorkForm'].resetFields();
                this.addWork = true;
            },

            /**
             * 添加作业表单验证方法
             * @param name
             * @returns
             */
            addWorkHandleSubmit: function (name) {
                this.addWorkForm.description = this.$refs.addEditor.getContent();
                const result = this.$refs[name].validate(valid => {
                    if (valid) {
                        this.addWorkAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
                return result;
            },

            /**
             * 添加作业Action
             */
            addWorkAction: function () {
                const params = this.addWorkForm;
                Http.postWork(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.addWorkForm = {
                            description: "",
                            chapterId: "",
                            name: ""
                        };
                        this.addWork = false;
                        this.$refs["addWorkForm"].resetFields();
                        this.$refs.CourseDetail.getWorkByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },

            /**
             * 编辑作业模态框
             * @param editWorkForm
             * @param knowledgeList
             */
            editWorkModal: function (editWorkForm, knowledgeList) {
                this.editWorkForm = editWorkForm;
                this.$refs.editEditor.setContent(this.editWorkForm.description);
                this.knowledgeList = knowledgeList;
                this.$refs['editWorkForm'].resetFields();
                this.editWork = true;
            },

            /**
             * 修改作业表单验证方法
             * @param name
             * @returns
             */
            editWorkHandleSubmit: async function (name) {
                this.editWorkForm.description = this.$refs.editEditor.getContent();
                const result = await this.$refs.editWorkForm.validate(valid => {});
                if (result) {
                    this.editWorkAction();
                } else {
                    this.$Message.error("表单信息不正确!");
                }
            },

            /**
             * 编辑作业Action
             */
            editWorkAction: function () {
                const params = this.editWorkForm;
                console.log("编辑作业Action");
                console.log(params);
                Http.putWork(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.editWorkForm = {
                            id: null,
                            description: "",
                            chapterId: "",
                            name: ""
                        };
                        this.editWork = false;
                        this.$refs["editWorkForm"].resetFields();
                        this.$refs.CourseDetail.getWorkByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },

            /**
             * 删除作业Action
             * @param id
             */
            deleteWorkAction: function (id) {
                const params = {
                    id: id
                };
                Http.deleteWork(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success("删除成功");
                        this.$refs.CourseDetail.getWorkByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },

            // 添加随堂作业模态框
            addClassWorkModal: function (addClassWorkForm, knowledgeList) {
                this.addClassWorkForm = addClassWorkForm;
                this.knowledgeList = knowledgeList;
                this.$refs['addClassWorkForm'].resetFields();
                this.addClassWork = true;
            },
            // 校验添加随堂作业
            addClassWorkHandleSubmit: function (name) {
                const result = this.$refs[name].validate(valid => {
                    if (valid) {
                        this.addClassWorkAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
                return result;
            },

            /**
             * 添加作业Action
             */
            addWorkAction: function () {
                const params = this.addWorkForm;
                Http.postWork(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.addWorkForm = {
                            description: "",
                            chapterId: "",
                            name: ""
                        };
                        this.addWork = false;
                        this.$refs["addWorkForm"].resetFields();
                        this.$refs.CourseDetail.getWorkByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                });
            },
            // 添加随堂作业Action
            addClassWorkAction: function () {
                const params = this.addClassWorkForm;
                console.log(params);
                Http.postKnowledgeTest(params).then(res=>{
                  if(res.statusCode === 1){
                    this.$Message.success(res.message);
                    this.addClassWorkForm = {
                            chapterId: null,
                            name: "",
                            item1:"",
                            item2:"",
                            item3:"",
                            item4:"",
                            ans:"",
                            knowledgeId:"",
                            courseId:""
                    };
                    this.addClassWork = false;
                    this.$refs["addClassWorkForm"].resetFields();
                    this.$refs.CourseDetail.getKnowledgeTestListByChapter();
                  } else {
                    this.$Message.error(res.message);
                  }
                })
            },
            // 随堂作业模态框
            editClassWorkModal: function (editClassWorkForm, knowledgeList) {
                this.editClassWorkForm = editClassWorkForm;
                this.knowledgeList = knowledgeList;
                this.$refs['editClassWorkForm'].resetFields();
                this.editClassWork = true;
            },
            // 校验修改随堂作业
            editClassWorkHandleSubmit: function (name) {
                const result = this.$refs[name].validate(valid => {
                    if (valid) {
                        this.editClassWorkAction();
                    } else {
                        this.$Message.error("表单信息不正确!");
                    }
                });
                return result;
            },
            // 修改随堂作业Action
            editClassWorkAction: function () {
                const params = this.editClassWorkForm;
                Http.editKnowledgeTest(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success(res.message);
                        this.editClassWorkForm = {
                            id:null,
                            chapterId: null,
                            name: "",
                            item1:"",
                            item2:"",
                            item3:"",
                            item4:"",
                            ans:"",
                            knowledgeId:"",
                            courseId:""
                        };
                        this.editClassWork = false;
                        this.$refs["editClassWorkForm"].resetFields();
                        this.$refs.CourseDetail.getKnowledgeTestListByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },

            // 删除随堂作业
            deleteClassWorkAction: function (id) {
                const params = {
                    id: id
                };
                Http.delectKnowledgeTest(params).then(res => {
                    if (res.statusCode === 1) {
                        this.$Message.success("删除成功");
                        this.$refs.CourseDetail.getKnowledgeTestListByChapter();
                    } else {
                        this.$Message.error(res.message);
                    }
                })
            },
        }
    };
</script>
<style lang="scss" scoped>
  @import "./CoursePage.scss";
</style>
